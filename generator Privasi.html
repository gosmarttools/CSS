:root {
  --primary-color: #2c3e50;
  --secondary-color: #3498db;
  --background-color: #f8f9fa;
  --text-color: #333;
  --border-color: #ddd;
  --success-color: #2ecc71;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.6;
  color: var(--text-color);
  background-color: var(--background-color);
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

header {
  text-align: center;
  margin-bottom: 2rem;
  padding: 1rem;
  border-bottom: 1px solid var(--border-color);
}

h1 {
  color: var(--primary-color);
  margin-bottom: 0.5rem;
}

.seo-description {
  margin: 1.5rem auto;
  max-width: 800px;
  color: #555;
  line-height: 1.6;
  font-size: 1.1rem;
  text-align: left;
  background-color: rgba(52, 152, 219, 0.05);
  padding: 1rem;
  border-radius: 8px;
  border-left: 4px solid var(--secondary-color);
}

.form-section {
  background-color: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  margin-bottom: 1.5rem;
}

h2 {
  color: var(--primary-color);
  margin-bottom: 1rem;
  font-size: 1.25rem;
}

.form-group {
  margin-bottom: 1rem;
}

label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
}

input[type="text"],
select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  font-size: 1rem;
}

.checkbox-group {
  margin-bottom: 1rem;
}

.checkbox-group p {
  margin-bottom: 0.5rem;
  font-weight: 500;
}

.checkbox-group label {
  display: flex;
  align-items: center;
  font-weight: normal;
  margin-bottom: 0.25rem;
}

.checkbox-group input[type="checkbox"] {
  margin-right: 0.5rem;
}

button {
  background-color: var(--secondary-color);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  font-size: 1rem;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s;
}

button:hover {
  background-color: #2980b9;
}

#generateBtn {
  display: block;
  width: 100%;
  font-weight: bold;
  margin-top: 1rem;
}

.hidden {
  display: none;
}

#result {
  background-color: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  margin-top: 2rem;
}

.result-controls {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

#policyPreview {
  border: 1px solid var(--border-color);
  padding: 1.5rem;
  border-radius: 4px;
  background-color: #f8f9fa;
  white-space: pre-line;
}

/* Info tooltips */
.info-tooltip {
    color: #3498db;
    cursor: help;
    margin-left: 5px;
    font-size: 16px;
    position: relative;
    display: inline-block;
}

.tooltip-popup {
    position: absolute;
    background-color: #333;
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 14px;
    max-width: 300px;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
}

.tooltip-popup::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
}

.info-tooltip:hover .tooltip-popup {
    opacity: 1;
    visibility: visible;
}

.field-help {
    font-size: 0.85rem;
    color: #666;
    margin-top: 5px;
    font-style: italic;
}

footer {
  margin-top: 3rem;
  text-align: center;
  font-size: 0.9rem;
  color: #666;
  border-top: 1px solid var(--border-color);
  padding-top: 1rem;
}

footer a {
  color: var(--secondary-color);
  text-decoration: none;
}

footer a:hover {
  text-decoration: underline;
}

@media (max-width: 768px) {
  body {
    padding: 10px;
  }
  
  .form-section {
    padding: 1rem;
  }
  
  .result-controls {
    flex-direction: column;
  }
  
  .result-controls button {
    width: 100%;
  }
}



{
  "version": "1.0",
  "sections": [
    {
      "id": "introduction",
      "title": "1. Introduction",
      "required": true,
      "content": "This Privacy Policy describes how {business_name} (\"we,\" \"us,\" or \"our\") collects, uses, and discloses your personal information when you use our {service_type} (the \"Service\").\n\nWe are committed to protecting your personal information and your right to privacy. When you visit our {service_type} and use our products, you trust us with your personal information. We take your privacy very seriously. In this Privacy Policy, we seek to explain to you in the clearest way possible what information we collect, how we use it, and what rights you have in relation to it.\n\nThis Privacy Policy applies to all information collected through our {service_type}, as well as any related services, sales, marketing, or events.\n\nPlease read this Privacy Policy carefully as it will help you understand what we do with the information we collect."
    },
    {
      "id": "definitions",
      "title": "2. Definitions",
      "required": true,
      "content": "To help explain things as clearly as possible in this Privacy Policy, every time any of these terms are referenced, they are strictly defined as:\n\n- **Cookie**: a small file placed on your device to enable certain features and functionality.\n- **Company**: when this policy mentions \"Company,\" \"we,\" \"us,\" or \"our,\" it refers to {business_name}.\n- **Country**: where {business_name} or the owners/founders of {business_name} are based, in this case {country}.\n- **Customer**: refers to the company, organization, or person that signs up to use the {business_name} Service.\n- **Device**: any internet-connected device such as a phone, tablet, computer, or any other device that can be used to visit {business_name} and use the services.\n- **Personal Data**: any information that directly, indirectly, or in connection with other information allows for the identification of a natural person.\n- **Service**: refers to the {service_type} provided by {business_name} as described in the relative terms and on this platform.\n- **Third-party service**: refers to advertisers, contest sponsors, promotional and marketing partners, and others who provide our content or whose products or services we think may interest you.\n- **Website**: {business_name}'s site, which can be accessed via {website_url}.\n- **You**: a person or entity that is registered with {business_name} to use the Services."
    },
    {
      "id": "information_collected",
      "title": "3. Information We Collect",
      "required": true,
      "content": "We collect several different types of information for various purposes to provide and improve our Service to you.",
      "subsections": [
        {
          "id": "personal_data",
          "title": "3.1 Personal Data",
          "condition": "data_collected.includes('personal')",
          "content": "While using our Service, we may ask you to provide us with certain personally identifiable information that can be used to contact or identify you. Personally identifiable information may include, but is not limited to:\n\n- Email address\n- First name and last name\n- Phone number\n- Address, State, Province, ZIP/Postal code, City\n- Cookies and Usage Data"
        },
        {
          "id": "financial_data",
          "title": "3.2 Financial Data",
          "condition": "data_collected.includes('financial')",
          "content": "Financial information such as payment method details (including credit card numbers, banking information) is collected and stored by our payment processors, and we may receive certain information from these payment processors to facilitate payments. All payment data is stored by our payment processor{financial_processors}, and you should review their privacy policies to understand their privacy practices."
        },
        {
          "id": "usage_data",
          "title": "3.3 Usage Data",
          "condition": "data_collected.includes('usage')",
          "content": "We may also collect information about how the Service is accessed and used (\"Usage Data\"). This Usage Data may include information such as your computer's Internet Protocol address (e.g. IP address), browser type, browser version, the pages of our Service that you visit, the time and date of your visit, the time spent on those pages, unique device identifiers and other diagnostic data."
        },
        {
          "id": "location_data",
          "title": "3.4 Location Data",
          "condition": "data_collected.includes('location')",
          "content": "We may use and store information about your location if you give us permission to do so (\"Location Data\"). We use this data to provide features of our Service, to improve and customize our Service.\n\nYou can enable or disable location services when you use our Service at any time, through your device settings."
        },
        {
          "id": "tracking_cookies",
          "title": "3.5 Tracking Technologies and Cookies",
          "condition": "data_collected.includes('cookies')",
          "content": "We use cookies and similar tracking technologies to track the activity on our Service and hold certain information.\n\nCookies are files with a small amount of data which may include an anonymous unique identifier. Cookies are sent to your browser from a website and stored on your device. Tracking technologies also used are beacons, tags, and scripts to collect and track information and to improve and analyze our Service.\n\nYou can instruct your browser to refuse all cookies or to indicate when a cookie is being sent. However, if you do not accept cookies, you may not be able to use some portions of our Service.\n\nExamples of Cookies we use:\n\n- **Session Cookies**: We use Session Cookies to operate our Service.\n- **Preference Cookies**: We use Preference Cookies to remember your preferences and various settings.\n- **Security Cookies**: We use Security Cookies for security purposes.\n- **Advertising Cookies**: Advertising Cookies are used to serve you with advertisements that may be relevant to you and your interests."
        }
      ]
    },
    {
      "id": "data_use",
      "title": "4. How We Use Your Information",
      "required": true,
      "content": "{business_name} uses the collected data for various purposes:\n\n- To provide and maintain our Service\n- To notify you about changes to our Service\n- To allow you to participate in interactive features of our Service when you choose to do so\n- To provide customer support\n- To gather analysis or valuable information so that we can improve our Service\n- To monitor the usage of our Service\n- To detect, prevent and address technical issues\n- To fulfill any other purpose for which you provide it\n- To provide you with news, special offers and general information about other goods, services and events which we offer that are similar to those that you have already purchased or enquired about unless you have opted not to receive such information\n- In any other way we may describe when you provide the information\n- For any other purpose with your consent"
    },
    {
      "id": "legal_basis_gdpr",
      "title": "5. Legal Basis for Processing Personal Data Under GDPR",
      "condition": "jurisdiction === 'eu' || jurisdiction === 'uk'",
      "content": "If you are from the European Economic Area (EEA), {business_name} legal basis for collecting and using the personal information described in this Privacy Policy depends on the Personal Data we collect and the specific context in which we collect it.\n\n{business_name} may process your Personal Data because:\n\n- We need to perform a contract with you\n- You have given us permission to do so\n- The processing is in our legitimate interests and it's not overridden by your rights\n- To comply with the law"
    },
    {
      "id": "data_retention",
      "title": "6. Retention of Your Personal Data",
      "required": true,
      "content": "{business_name} will retain your Personal Data only for as long as is necessary for the purposes set out in this Privacy Policy. We will retain and use your Personal Data to the extent necessary to comply with our legal obligations (for example, if we are required to retain your data to comply with applicable laws), resolve disputes, and enforce our legal agreements and policies.\n\n{business_name} will also retain Usage Data for internal analysis purposes. Usage Data is generally retained for a shorter period of time, except when this data is used to strengthen the security or to improve the functionality of our Service, or we are legally obligated to retain this data for longer time periods.",
      "subsections": [
        {
          "id": "ecommerce_physical_goods_retention",
          "title": "6.1 Data Retention for Physical Goods",
          "condition": "businessType === 'ecommerce'",
          "content": "For orders involving physical goods, we retain your shipping and billing information, including your name, address, and contact details, as necessary to fulfill your order, process returns, manage warranty claims, and comply with tax, legal, and regulatory obligations. This information may be retained for a longer period than other personal data to ensure proper delivery of goods and to handle any post-purchase issues that may arise."
        }
      ]
    },
    {
      "id": "data_transfer",
      "title": "7. Transfer of Your Personal Data",
      "required": true,
      "content": "Your information, including Personal Data, may be transferred to — and maintained on — computers located outside of your state, province, country or other governmental jurisdiction where the data protection laws may differ from those of your jurisdiction.\n\nIf you are located outside {country} and choose to provide information to us, please note that we transfer the data, including Personal Data, to {country} and process it there.\n\nYour consent to this Privacy Policy followed by your submission of such information represents your agreement to that transfer.\n\n{business_name} will take all steps reasonably necessary to ensure that your data is treated securely and in accordance with this Privacy Policy and no transfer of your Personal Data will take place to an organization or a country unless there are adequate controls in place including the security of your data and other personal information."
    },
    {
      "id": "disclosure",
      "title": "8. Disclosure of Your Personal Data",
      "required": true,
      "content": "### Business Transactions\n\nIf {business_name} is involved in a merger, acquisition or asset sale, your Personal Data may be transferred. We will provide notice before your Personal Data is transferred and becomes subject to a different Privacy Policy.\n\n### Disclosure for Law Enforcement\n\nUnder certain circumstances, {business_name} may be required to disclose your Personal Data if required to do so by law or in response to valid requests by public authorities (e.g. a court or a government agency).\n\n### Legal Requirements\n\n{business_name} may disclose your Personal Data in the good faith belief that such action is necessary to:\n\n- Comply with a legal obligation\n- Protect and defend the rights or property of {business_name}\n- Prevent or investigate possible wrongdoing in connection with the Service\n- Protect the personal safety of users of the Service or the public\n- Protect against legal liability"
    },
    {
      "id": "third_party_disclosure",
      "title": "9. Third-Party Disclosure",
      "required": true,
      "subsections": [
        {
          "id": "analytics",
          "title": "9.1 Analytics",
          "condition": "third_parties.includes('analytics')",
          "content": "We may use third-party Service Providers to monitor and analyze the use of our Service.\n\n- **Google Analytics**: Google Analytics is a web analytics service offered by Google that tracks and reports website traffic. Google uses the data collected to track and monitor the use of our Service. This data is shared with other Google services. Google may use the collected data to contextualize and personalize the ads of its own advertising network. You can opt-out of having made your activity on the Service available to Google Analytics by installing the Google Analytics opt-out browser add-on. The add-on prevents the Google Analytics JavaScript from sharing information with Google Analytics about visits activity. For more information on the privacy practices of Google, please visit the Google Privacy & Terms web page: [https://policies.google.com/privacy](https://policies.google.com/privacy)"
        },
        {
          "id": "advertising",
          "title": "9.2 Advertising",
          "condition": "third_parties.includes('advertising')",
          "content": "We may use third-party Service Providers to show advertisements to you to help support and maintain our Service.\n\n- **Google AdSense & DoubleClick Cookie**: Google, as a third-party vendor, uses cookies to serve ads on our Service. Google's use of the DoubleClick cookie enables it and its partners to serve ads to our users based on their visit to our Service or other websites on the Internet. You may opt out of the use of the DoubleClick Cookie for interest-based advertising by visiting the Google Ads Settings web page: [http://www.google.com/ads/preferences/](http://www.google.com/ads/preferences/)"
        },
        {
          "id": "payment",
          "title": "9.3 Payments",
          "condition": "third_parties.includes('payment')",
          "content": "We may provide paid products and/or services within the Service. In that case, we use third-party services for payment processing (e.g. payment processors).\n\nWe will not store or collect your payment card details. That information is provided directly to our third-party payment processors whose use of your personal information is governed by their Privacy Policy. These payment processors adhere to the standards set by PCI-DSS as managed by the PCI Security Standards Council, which is a joint effort of brands like Visa, Mastercard, American Express and Discover. PCI-DSS requirements help ensure the secure handling of payment information.\n\nThe payment processors we work with are:\n\n- **PayPal or Braintree**: Their Privacy Policy can be viewed at [https://www.paypal.com/webapps/mpp/ua/privacy-full](https://www.paypal.com/webapps/mpp/ua/privacy-full)\n- **Stripe**: Their Privacy Policy can be viewed at [https://stripe.com/us/privacy](https://stripe.com/us/privacy)"
        },
        {
          "id": "paypal_only",
          "title": "9.3 PayPal Payments Only",
          "condition": "third_parties.includes('paypal_only')",
          "content": "For all payment processing, we exclusively use PayPal as our payment processor. When you make a purchase on our site, you will be directed to PayPal to complete your transaction.\n\n**We do not collect, store, or process any payment card details on our servers.** All payment information is provided directly to PayPal, whose use of your personal information is governed by their Privacy Policy, which can be viewed at [https://www.paypal.com/webapps/mpp/ua/privacy-full](https://www.paypal.com/webapps/mpp/ua/privacy-full).\n\nPayPal adheres to the standards set by PCI-DSS as managed by the PCI Security Standards Council, which is a joint effort of brands like Visa, Mastercard, American Express and Discover. PCI-DSS requirements help ensure the secure handling of payment information."
        },
        {
          "id": "cloud",
          "title": "9.4 Cloud Services",
          "condition": "third_parties.includes('cloud')",
          "content": "We may use third-party cloud service providers to host our Service and store your data.\n\n- **Amazon Web Services (AWS)**: Their Privacy Policy can be viewed at [https://aws.amazon.com/privacy/](https://aws.amazon.com/privacy/)\n- **Microsoft Azure**: Their Privacy Policy can be viewed at [https://privacy.microsoft.com/en-us/privacystatement](https://privacy.microsoft.com/en-us/privacystatement)\n- **Google Cloud Platform**: Their Privacy Policy can be viewed at [https://cloud.google.com/terms/cloud-privacy-notice](https://cloud.google.com/terms/cloud-privacy-notice)"
        }
      ]
    },
    {
      "id": "security",
      "title": "10. Security of Your Personal Data",
      "required": true,
      "content": "The security of your Personal Data is important to us, but remember that no method of transmission over the Internet, or method of electronic storage is 100% secure. While we strive to use commercially acceptable means to protect your Personal Data, we cannot guarantee its absolute security."
    },
    {
      "id": "children_privacy",
      "title": "11. Children's Privacy",
      "required": true,
      "content": "Our Service does not address anyone under the age of 13. We do not knowingly collect personally identifiable information from anyone under the age of 13. If you are a parent or guardian and you are aware that your child has provided us with Personal Data, please contact us. If we become aware that we have collected Personal Data from anyone under the age of 13 without verification of parental consent, we take steps to remove that information from our servers.\n\nIf we need to rely on consent as a legal basis for processing your information and your country requires consent from a parent, we may require your parent's consent before we collect and use that information."
    },
    {
      "id": "your_rights",
      "title": "12. Your Data Protection Rights",
      "required": true,
      "content": "Depending on your location and applicable laws, you may have certain rights regarding your personal information, including rights to access, correct, delete, or restrict use of your information. We honor these rights regardless of your location and are committed to providing reasonable access to the information that you have shared with us.",
      "subsections": [
        {
          "id": "general_data_rights",
          "title": "12.1 General Data Access & Deletion Rights",
          "required": true,
          "content": "Regardless of your location, you can make the following requests regarding your personal data:\n\n- **Access Your Data**: You can request a copy of the personal information we have about you. We will provide this information in a structured, commonly used, and machine-readable format.\n\n- **Delete Your Data**: You can request that we delete your personal information from our systems. We will comply with this request unless there is a legal requirement for us to keep certain information.\n\nTo submit a data access or deletion request, please contact us using the contact information provided at the end of this Privacy Policy. We will respond to your request within 30 days. We may need to verify your identity before processing your request."
        },
        {
          "id": "gdpr_rights",
          "title": "12.2 GDPR Data Protection Rights (EU & UK Residents)",
          "condition": "jurisdiction === 'eu' || jurisdiction === 'uk'",
          "content": "If you are a resident of the European Economic Area (EEA) or the United Kingdom, you have certain data protection rights under the GDPR and UK GDPR. {business_name} aims to take reasonable steps to allow you to correct, amend, delete, or limit the use of your Personal Data.\n\nIf you wish to be informed what Personal Data we hold about you and if you want it to be removed from our systems, please contact us.\n\nIn certain circumstances, you have the following data protection rights:\n\n- **The right to access, update or to delete** the information we have on you. Whenever made possible, you can access, update or request deletion of your Personal Data directly within your account settings section. If you are unable to perform these actions yourself, please contact us to assist you. We will comply with such requests within 30 days.\n\n- **The right of rectification.** You have the right to have your information rectified if that information is inaccurate or incomplete\n\n- **The right to object** to our processing of your Personal Data\n\n- **The right of restriction.** You have the right to request that we restrict the processing of your personal information\n\n- **The right to data portability.** You have the right to be provided with a copy of your Personal Data in a structured, machine-readable and commonly used format\n\n- **The right to withdraw consent.** You also have the right to withdraw your consent at any time where {business_name} relied on your consent to process your personal information\n\nPlease note that we may ask you to verify your identity before responding to such requests.\n\nYou have the right to complain to a Data Protection Authority about our collection and use of your Personal Data. For more information, please contact your local data protection authority in the European Economic Area (EEA) or the UK Information Commissioner's Office (ICO)."
        },
        {
          "id": "ccpa_rights",
          "title": "12.3 CCPA Privacy Rights (California Residents)",
          "condition": "jurisdiction === 'us'",
          "content": "If you are a California resident, you are entitled to learn what data we collect about you, ask to delete your data and not to sell (share) it. To exercise your data protection rights, you can make certain requests and ask us:\n\n- **What personal information we have about you.** If you make this request, we will return to you:\n  - The categories of personal information we have collected about you\n  - The categories of sources from which we collect your personal information\n  - The business or commercial purpose for collecting or selling your personal information\n  - The categories of third parties with whom we share personal information\n  - The specific pieces of personal information we have collected about you\n  - A list of categories of personal information that we have sold, along with the category of any other company we sold it to\n  - A list of categories of personal information that we have disclosed for a business purpose, along with the category of any other company we shared it with\n\n- **To delete your personal information.** If you make this request, we will delete the personal information we hold about you as of the date of your request from our records and direct any service providers to do the same. In some cases, deletion may be accomplished through de-identification of the information. If you choose to delete your personal information, you may not be able to use certain functions that require your personal information to operate.\n\n- **To stop selling your personal information.** We don't sell or rent your personal information to any third parties for any purpose. We do not sell your personal information for monetary consideration. However, under some state laws, sharing your data through certain targeted advertisements may be considered a \"sale\" of information. You are the only owner of your Personal Data and can request disclosure or deletion at any time.\n\nWe will respond to verified requests within 45 days as required by the CCPA. If we need more time, we will inform you of the reason and extension period in writing.\n\nPlease note, if you ask us to delete or stop selling your data, it may impact your experience with us, and you may not be able to participate in certain programs or membership services which require the usage of your personal information to function. But in no circumstances, we will discriminate against you for exercising your rights.\n\nTo exercise your California data protection rights described above, please send your request(s) by email: {contact_email}.\n\nYour data protection rights, described above, are covered by the CCPA, short for the California Consumer Privacy Act. To find out more, visit the official California Legislative Information website. The CCPA took effect on 01/01/2020."
        },
        {
          "id": "canada_rights",
          "title": "12.4 Canadian Privacy Rights",
          "condition": "jurisdiction === 'ca'",
          "content": "Under Canada's Personal Information Protection and Electronic Documents Act (PIPEDA) and provincial privacy laws, you have the right to:\n\n- Access your personal information in our custody or control\n- Request correction of your personal information if it is inaccurate or incomplete\n- Withdraw consent to the collection, use, or disclosure of your personal information\n- File a complaint with the Office of the Privacy Commissioner of Canada about the handling of your personal information\n\nWe will respond to your access or correction request within 30 days, unless an extension is required. There may be situations where we cannot provide access to all the personal information we hold about you, such as if doing so would reveal personal information about another individual or if the information is protected by legal privilege."
        },
        {
          "id": "australia_rights",
          "title": "12.5 Australian Privacy Rights",
          "condition": "jurisdiction === 'au'",
          "content": "Under the Australian Privacy Principles (APPs), you have the right to:\n\n- Request access to your personal information\n- Request correction of your personal information\n- Opt-out of receiving direct marketing communications\n- Make a complaint about a breach of the APPs\n\nWe will respond to your access or correction request within 30 days. If we refuse to give you access to or correct your personal information, we will provide you with reasons for our decision and information about how to make a complaint if you are not satisfied with our response."
        },
        {
          "id": "global_rights",
          "title": "12.6 Other Jurisdictions",
          "condition": "jurisdiction === 'global'",
          "content": "Many countries around the world have adopted comprehensive data protection laws that provide various rights to individuals regarding their personal data. Even if we haven't specifically listed your country's laws, we're committed to respecting your rights to access and delete your personal information wherever you are located.\n\nIf you have any questions about exercising your data rights, please contact us using the information provided in the \"Contact Us\" section below."
        }
      ]
    },
    {
      "id": "service_providers",
      "title": "13. Service Providers",
      "required": true,
      "content": "We may employ third-party companies and individuals to facilitate our Service (\"Service Providers\"), to provide the Service on our behalf, to perform Service-related services or to assist us in analyzing how our Service is used.\n\nThese third parties have access to your Personal Data only to perform these tasks on our behalf and are obligated not to disclose or use it for any other purpose."
    },
    {
      "id": "links_other_sites",
      "title": "14. Links to Other Sites",
      "required": true,
      "content": "Our Service may contain links to other sites that are not operated by us. If you click on a third party link, you will be directed to that third party's site. We strongly advise you to review the Privacy Policy of every site you visit.\n\nWe have no control over and assume no responsibility for the content, privacy policies or practices of any third party sites or services."
    },
    {
      "id": "changes_policy",
      "title": "15. Changes to This Privacy Policy",
      "required": true,
      "content": "We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page.\n\nWe will let you know via email and/or a prominent notice on our Service, prior to the change becoming effective and update the \"effective date\" at the top of this Privacy Policy.\n\nYou are advised to review this Privacy Policy periodically for any changes. Changes to this Privacy Policy are effective when they are posted on this page."
    },
    {
      "id": "contact_us",
      "title": "16. Contact Us",
      "required": true,
      "content": "If you have any questions about this Privacy Policy, please contact us:\n\n- By email: {contact_email}\n- By visiting this page on our website: {contact_page}\n- By phone number: {contact_phone}\n- By mail: {business_address}"
    }
  ]
}
{
  "us": {
    "name": "United States",
    "dataRights": "Under US laws like the California Consumer Privacy Act (CCPA), California residents have the right to know what personal information is collected about them, request deletion of their personal information, opt-out of the sale of their personal information, and not be discriminated against for exercising these rights.",
    "dataRetention": "We will retain your personal information only for as long as necessary to fulfill the purposes for which it was collected, or as required by applicable laws and regulations.",
    "specificRequirements": "If you are a California resident, you have specific rights under the CCPA. For more information about your California privacy rights, please see our CCPA Privacy Notice.",
    "requiredElements": ["ccpa", "coppa_statement", "security_measures"]
  },
  "eu": {
    "name": "European Union (GDPR)",
    "dataRights": "Under the General Data Protection Regulation (GDPR), you have the right to access, rectify, or erase your personal data, the right to restrict or object to our processing of your data, and the right to data portability. You also have the right to withdraw consent at any time where we rely on consent to process your personal data.",
    "dataRetention": "We will retain your personal information only for as long as necessary to fulfill the purposes for which it was collected, and to comply with our legal obligations. The criteria used to determine our retention periods include the nature of the data, the purposes for processing, and legal requirements.",
    "specificRequirements": "We process your data based on one or more legal grounds: your consent, the necessity to perform a contract with you, compliance with a legal obligation, protection of vital interests, public interest, or our legitimate interests where these are not overridden by your data protection rights.",
    "requiredElements": ["legal_basis", "international_transfers", "automated_decision_making", "dpo_details"]
  },
  "uk": {
    "name": "United Kingdom",
    "dataRights": "Under UK data protection laws, including the UK GDPR and Data Protection Act 2018, you have the right to access, rectify, or erase your personal data, the right to restrict or object to our processing of your data, and the right to data portability. You also have the right to withdraw consent where applicable.",
    "dataRetention": "We will retain your personal information only for as long as necessary to fulfill the purposes for which it was collected, and to comply with our legal obligations. The criteria used to determine our retention periods include the nature of the data, the purposes for processing, and legal requirements.",
    "specificRequirements": "We process your data based on one or more legal grounds: your consent, the necessity to perform a contract with you, compliance with a legal obligation, protection of vital interests, public interest, or our legitimate interests where these are not overridden by your data protection rights.",
    "requiredElements": ["legal_basis", "international_transfers", "ico_registration"]
  },
  "ca": {
    "name": "Canada",
    "dataRights": "Under the Personal Information Protection and Electronic Documents Act (PIPEDA) and other Canadian privacy laws, you have the right to access your personal information, challenge the accuracy of your information, and have it amended as appropriate.",
    "dataRetention": "We will only retain personal information for as long as necessary to fulfill the purposes for which it was collected, or as required by applicable laws.",
    "specificRequirements": "We obtain consent for the collection, use, and disclosure of personal information, except where inappropriate. Personal information is only used for the purposes for which it was collected.",
    "requiredElements": ["consent_requirements", "accuracy_statements"]
  },
  "au": {
    "name": "Australia",
    "dataRights": "Under the Australian Privacy Principles (APPs), you have the right to access your personal information, request correction of inaccurate information, and make complaints about breaches of the APPs.",
    "dataRetention": "We will retain your personal information only for as long as necessary to fulfill the purposes for which it was collected, or as required by applicable laws.",
    "specificRequirements": "We take reasonable steps to ensure the personal information we collect is accurate, up-to-date, and complete. We protect personal information from misuse, interference, loss, and unauthorized access.",
    "requiredElements": ["app_compliance", "overseas_disclosure"]
  },
  "global": {
    "name": "Global",
    "dataRights": "You have the right to access your personal information, request correction of inaccurate information, and request deletion of your data in certain circumstances. You may also have the right to object to certain processing of your information.",
    "dataRetention": "We will retain your personal information only for as long as necessary to fulfill the purposes for which it was collected, or as required by applicable laws.",
    "specificRequirements": "As we operate globally, we comply with applicable data protection laws in each jurisdiction where we collect or process personal information.",
    "requiredElements": ["general_rights", "security_measures"]
  }
}

{
  "version": "1.0",
  "ecommerce": {
    "name": "E-Commerce",
    "description": "For online stores and e-commerce websites",
    "specifics": [
      {
        "id": "order_processing",
        "title": "Order Processing",
        "content": "We process your personal information to fulfill orders, process payments, arrange for shipping, and provide you with invoices and/or order confirmations. We use trusted third-party payment processors to handle secure payment transactions."
      },
      {
        "id": "customer_accounts",
        "title": "Customer Accounts",
        "content": "When you create an account on our site, we store your name, address, email, and phone number, which enables you to check out faster in the future, store multiple shipping addresses, view and track your orders, and more."
      },
      {
        "id": "physical_goods_data_retention",
        "title": "Data Retention for Physical Goods",
        "content": "For orders involving physical goods, we retain your shipping and billing information, including your name, address, and contact details, as necessary to fulfill your order, process returns, manage warranty claims, and comply with tax, legal, and regulatory obligations. This information may be retained for a longer period than other personal data to ensure proper delivery of goods and to handle any post-purchase issues that may arise."
      },
      {
        "id": "marketing",
        "title": "Marketing Communications",
        "content": "With your permission, we may send you emails about our store, new products and other updates. You have the right to opt-out of receiving marketing communications at any time."
      }
    ]
  },
  "blog": {
    "name": "Blog/Content Site",
    "description": "For blogs, news sites, and content-focused websites",
    "specifics": [
      {
        "id": "comments",
        "title": "Comments",
        "content": "When visitors leave comments on the site we collect the data shown in the comments form, and also the visitor's IP address and browser user agent string to help spam detection."
      },
      {
        "id": "subscription",
        "title": "Subscriptions",
        "content": "If you subscribe to our blog or newsletter, we collect your email address to send you content updates. You can unsubscribe at any time using the link provided in each email."
      }
    ]
  },
  "saas": {
    "name": "SaaS/Web App",
    "description": "For software-as-a-service applications",
    "specifics": [
      {
        "id": "account_data",
        "title": "Account Data",
        "content": "To access and use our services, you need to create an account. We collect your name, email address, password, and any other information necessary to set up and maintain your account."
      },
      {
        "id": "service_data",
        "title": "Service Data",
        "content": "We collect information that you upload, create, or modify when using our services, including any files, content, or data you choose to store within our application."
      },
      {
        "id": "subscription_billing",
        "title": "Subscription and Billing",
        "content": "For paid services, we collect billing information including payment method details, billing address, and transaction history. This information is used to process payments and maintain your subscription."
      }
    ]
  },
  "mobile": {
    "name": "Mobile App",
    "description": "For iOS, Android, and other mobile applications",
    "specifics": [
      {
        "id": "device_info",
        "title": "Device Information",
        "content": "We collect information about your mobile device, including model, operating system, unique device identifiers, mobile network information, and in some cases, your device's location."
      },
      {
        "id": "app_usage",
        "title": "App Usage",
        "content": "We collect information about how you use our app, including your interactions with various features, screens you visit, and actions you take within the app."
      },
      {
        "id": "push_notifications",
        "title": "Push Notifications",
        "content": "With your consent, we may send push notifications to your device. You can disable push notifications in your device settings at any time."
      }
    ]
  },
  "nonprofit": {
    "name": "Non-Profit",
    "description": "For non-profit organizations and charities",
    "specifics": [
      {
        "id": "donation_processing",
        "title": "Donation Processing",
        "content": "When you make a donation, we collect payment information, billing details, and contact information. This information is used to process your donation, issue receipts, and maintain donation records for tax and regulatory compliance."
      },
      {
        "id": "volunteer_info",
        "title": "Volunteer Information",
        "content": "If you sign up as a volunteer, we collect personal details such as your name, contact information, skills, availability, and any other information necessary to coordinate volunteer activities."
      }
    ]
  },
  "general": {
    "name": "General Website",
    "description": "Generic template for most websites",
    "specifics": [
      {
        "id": "contact_form",
        "title": "Contact Forms",
        "content": "When you fill out a contact form on our website, we collect the personal information you provide, such as your name, email address, and any message you send us. This information is used to respond to your inquiries."
      }
    ]
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const policyForm = document.getElementById('policyForm');
  const resultSection = document.getElementById('result');
  const policyPreview = document.getElementById('policyPreview');
  const copyBtn = document.getElementById('copyBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const downloadMarkdownBtn = document.getElementById('downloadMarkdownBtn');
  const resetBtn = document.getElementById('resetBtn');
  
  // Initialize the generator
  const generator = new PrivacyPolicyGenerator();
  let generatedPolicy = null;
  
  // Wait for all resources to load before allowing generation
  window.addEventListener('load', () => {
    console.log('All resources loaded');
  });
  
  // Add event listeners to prevent selecting both payment options
  const paymentCheckbox = document.querySelector('input[name="thirdParties"][value="payment"]');
  const paypalOnlyCheckbox = document.querySelector('input[name="thirdParties"][value="paypal_only"]');
  
  if (paymentCheckbox && paypalOnlyCheckbox) {
    paymentCheckbox.addEventListener('change', function() {
      if (this.checked && paypalOnlyCheckbox.checked) {
        paypalOnlyCheckbox.checked = false;
      }
    });
    
    paypalOnlyCheckbox.addEventListener('change', function() {
      if (this.checked && paymentCheckbox.checked) {
        paymentCheckbox.checked = false;
      }
    });
  }
  
  policyForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    try {
      // Show loading indicator
      policyPreview.innerHTML = '<p>Generating your comprehensive privacy policy...</p>';
      resultSection.classList.remove('hidden');
      policyForm.classList.add('hidden');
      
      // Collect form data, including the additional fields
      const formData = {
        businessName: document.getElementById('businessName').value,
        businessType: document.getElementById('businessType').value,
        jurisdiction: document.getElementById('jurisdiction').value,
        sellRegions: Array.from(document.querySelectorAll('input[name="sell_regions"]:checked')).map(cb => cb.value),
        dataCollected: Array.from(document.querySelectorAll('input[name="dataCollected"]:checked')).map(cb => cb.value),
        thirdParties: Array.from(document.querySelectorAll('input[name="thirdParties"]:checked')).map(cb => cb.value),
        compliance: Array.from(document.querySelectorAll('input[name="compliance"]:checked')).map(cb => cb.value),
        
        // Additional fields
        websiteUrl: document.getElementById('websiteUrl')?.value || '',
        country: document.getElementById('country')?.value || 'United States',
        businessAddress: document.getElementById('businessAddress')?.value || '',
        contactEmail: document.getElementById('contactEmail')?.value || '',
        contactPhone: document.getElementById('contactPhone')?.value || '',
        contactPage: document.getElementById('contactPage')?.value || ''
      };
      
      console.log('Generating policy with data:', formData);
      
      // Generate the policy (with a small delay to allow the UI to update)
      setTimeout(async () => {
        try {
          generatedPolicy = await generator.generate(formData);
          
          // Display the policy
          if (generatedPolicy && generatedPolicy.html) {
            console.log('Policy generated successfully');
            policyPreview.innerHTML = generatedPolicy.html;
          } else {
            throw new Error('Generated policy is empty or invalid');
          }
        } catch (error) {
          console.error('Error generating policy:', error);
          policyPreview.innerHTML = `
            <div style="color: #721c24; background-color: #f8d7da; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
              <h3>Error Generating Policy</h3>
              <p>${error.message || 'Unknown error occurred'}</p>
              <p>Please check your inputs and try again. If the problem persists, try refreshing the page.</p>
              <details>
                <summary>Technical Details</summary>
                <pre>${error.stack || 'No stack trace available'}</pre>
              </details>
            </div>
          `;
        }
      }, 100);
    } catch (error) {
      console.error('Form submission error:', error);
      policyPreview.innerHTML = `<p>Error: ${error.message}</p>`;
    }
  });
  
  // Copy to clipboard functionality
  copyBtn.addEventListener('click', () => {
    if (!generatedPolicy) return;
    
    // Try to use the Clipboard API if available
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(generatedPolicy.text)
        .then(() => alert('Privacy policy copied to clipboard!'))
        .catch(err => {
          console.error('Could not copy text: ', err);
          fallbackCopy();
        });
    } else {
      fallbackCopy();
    }
    
    function fallbackCopy() {
      const tempTextarea = document.createElement('textarea');
      tempTextarea.value = generatedPolicy.text;
      document.body.appendChild(tempTextarea);
      tempTextarea.select();
      document.execCommand('copy');
      document.body.removeChild(tempTextarea);
      alert('Privacy policy copied to clipboard!');
    }
  });
  
  // Download as HTML functionality
  downloadBtn.addEventListener('click', () => {
    if (!generatedPolicy) return;
    
    const blob = new Blob([generatedPolicy.html], {type: 'text/html'});
    downloadFile(blob, 'privacy-policy.html');
  });
  
  // Download as Markdown functionality
  downloadMarkdownBtn.addEventListener('click', () => {
    if (!generatedPolicy) return;
    
    const blob = new Blob([generatedPolicy.markdown], {type: 'text/markdown'});
    downloadFile(blob, 'privacy-policy.md');
  });
  
  function downloadFile(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
  
  // Reset form functionality
  resetBtn.addEventListener('click', () => {
    policyForm.reset();
    resultSection.classList.add('hidden');
    policyForm.classList.remove('hidden');
  });
  
  // Initialize tooltips - simplified and more reliable implementation
  function initializeTooltips() {
    document.querySelectorAll('.info-tooltip').forEach(tooltip => {
      // Create tooltip element if it doesn't exist
      if (!tooltip.querySelector('.tooltip-popup')) {
        const tooltipContent = tooltip.getAttribute('title') || tooltip.getAttribute('data-tooltip');
        if (tooltipContent) {
          // Store content in data attribute and remove title to prevent default browser tooltip
          tooltip.setAttribute('data-tooltip', tooltipContent);
          tooltip.removeAttribute('title');
          
          // Create tooltip element
          const tooltipEl = document.createElement('div');
          tooltipEl.className = 'tooltip-popup';
          tooltipEl.textContent = tooltipContent;
          tooltip.appendChild(tooltipEl);
          
          // Position tooltip centered above the icon
          tooltipEl.style.bottom = '24px';
          tooltipEl.style.left = '50%';
          tooltipEl.style.transform = 'translateX(-50%)';
        }
      }
    });
  }
  
  // Initialize tooltips after DOM content loaded
  initializeTooltips();
  
  // Also initialize tooltips after any dynamic content is added
  const observer = new MutationObserver(mutations => {
    mutations.forEach(mutation => {
      if (mutation.addedNodes.length) {
        initializeTooltips();
      }
    });
  });
  
  observer.observe(document.body, { childList: true, subtree: true });
});



/**
 * Privacy Policy Generator
 * Core functionality for generating comprehensive privacy policies based on user inputs
 */

class PrivacyPolicyGenerator {
  constructor() {
    this.templates = {};
    this.jurisdictions = {};
    this.comprehensiveTemplate = {};
    this.debug = true; // Enable debugging
    
    // Initialize with loading necessary data
    this.loadTemplates();
    this.loadJurisdictions();
    this.loadComprehensiveTemplate();
  }
  
  // Helper method for logging
  log(message, data) {
    if (this.debug) {
      console.log(`[PolicyGenerator] ${message}`, data || '');
    }
  }
  
  async loadTemplates() {
    try {
      this.log('Loading templates...');
      const response = await fetch('./data/templates.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      this.templates = await response.json();
      this.log('Templates loaded successfully', this.templates);
    } catch (error) {
      console.error('Failed to load templates:', error);
      this.log('Using fallback templates');
      // Fallback to embedded minimal templates if fetch fails
      this.templates = {
        version: "1.0",
        ecommerce: { 
          name: "E-Commerce",
          specifics: []
        },
        blog: { 
          name: "Blog/Content Site",
          specifics: []
        },
        saas: { 
          name: "SaaS/Web App",
          specifics: []
        },
        mobile: { 
          name: "Mobile App",
          specifics: []
        },
        nonprofit: { 
          name: "Non-Profit",
          specifics: []
        },
        general: {
          name: "General Website",
          specifics: []
        }
      };
    }
  }
  
  async loadJurisdictions() {
    try {
      this.log('Loading jurisdictions...');
      const response = await fetch('./data/jurisdictions.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      this.jurisdictions = await response.json();
      this.log('Jurisdictions loaded successfully', this.jurisdictions);
    } catch (error) {
      console.error('Failed to load jurisdictions:', error);
      this.log('Using fallback jurisdictions');
      // Fallback to embedded minimal jurisdiction rules
      this.jurisdictions = {
        us: { name: "United States", dataRights: "Various rights under state laws" },
        eu: { name: "European Union (GDPR)", dataRights: "Rights under GDPR" },
        uk: { name: "United Kingdom", dataRights: "Rights under UK GDPR" },
        ca: { name: "Canada", dataRights: "Rights under PIPEDA" },
        au: { name: "Australia", dataRights: "Rights under Privacy Act" },
        global: { name: "Global", dataRights: "Basic data rights" }
      };
    }
  }
  
  async loadComprehensiveTemplate() {
    try {
      this.log('Loading comprehensive template...');
      const response = await fetch('./data/comprehensive-template.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      this.comprehensiveTemplate = await response.json();
      this.log('Comprehensive template loaded successfully');
    } catch (error) {
      console.error('Failed to load comprehensive template:', error);
      this.log('Using fallback comprehensive template');
      // Fallback to basic structure if fetch fails
      this.comprehensiveTemplate = {
        version: "1.0",
        sections: [
          {
            id: "introduction",
            title: "1. Introduction",
            required: true,
            content: "This is a basic privacy policy for {business_name}."
          },
          {
            id: "information_collected",
            title: "2. Information We Collect",
            required: true,
            content: "We collect basic information necessary to provide our services."
          },
          {
            id: "contact_us",
            title: "3. Contact Us",
            required: true,
            content: "If you have questions, contact {business_name}."
          }
        ]
      };
    }
  }
  
  generate(formData) {
    try {
      this.log('Generating policy with data:', formData);
      
      // Check if necessary data is loaded
      if (!this.comprehensiveTemplate.sections || this.comprehensiveTemplate.sections.length === 0) {
        throw new Error('Comprehensive template not properly loaded');
      }
      
      // Extract data from form
      const {
        businessName,
        businessType,
        jurisdiction,
        dataCollected = [],
        thirdParties = [],
        contactEmail = '',
        contactPhone = '',
        businessAddress = '',
        contactPage = '',
        websiteUrl = '',
        country = 'United States', // Default value
        sellRegions = [] // Additional regions where business operates
      } = formData;
      
      // Validate required fields
      if (!businessName) throw new Error('Business name is required');
      if (!businessType) throw new Error('Business type is required');
      if (!jurisdiction) throw new Error('Jurisdiction is required');
      
      this.log('Preparing data for template');
      
      // Generate the comprehensive policy
      const policy = this.generateComprehensivePolicy({
        business_name: businessName,
        service_type: this.getServiceType(businessType),
        jurisdiction,
        sellRegions,
        data_collected: dataCollected,
        third_parties: thirdParties,
        contact_email: contactEmail,
        contact_phone: contactPhone,
        business_address: businessAddress,
        contact_page: contactPage,
        website_url: websiteUrl,
        country,
        financial_processors: this.getFinancialProcessors(thirdParties),
        effective_date: new Date().toLocaleDateString()
      });
      
      this.log('Policy generated successfully');
      
      return {
        html: this.formatAsHTML(policy, businessName),
        markdown: this.formatAsMarkdown(policy, businessName),
        text: this.formatAsText(policy, businessName)
      };
    } catch (error) {
      console.error('Error generating policy:', error);
      throw new Error(`Failed to generate policy: ${error.message}`);
    }
  }
  
  getServiceType(businessType) {
    const types = {
      'ecommerce': 'online store and services',
      'blog': 'website and blog',
      'saas': 'software as a service',
      'mobile': 'mobile application',
      'nonprofit': 'website and services'
    };
    
    return types[businessType] || 'website and services';
  }
  
  getFinancialProcessors(thirdParties) {
    if (thirdParties && thirdParties.includes('payment')) {
      return ' (such as PayPal, Stripe, etc.)';
    }
    return '';
  }
  
  generateComprehensivePolicy(data) {
    try {
      this.log('Generating comprehensive policy with data');
      
      const { sections } = this.comprehensiveTemplate;
      if (!sections || !Array.isArray(sections)) {
        throw new Error('Template sections not properly defined');
      }
      
      const policySections = [];
      
      // Handle primary jurisdiction first (based on where business is located)
      const primaryJurisdiction = data.jurisdiction;
      
      // Also consider regions where business sells to or operates in
      const sellRegions = data.sellRegions || [];
      
      for (const section of sections) {
        try {
          // Skip sections that don't apply based on conditions
          if (section.condition) {
            // Support for sell regions - if condition checks jurisdiction, also check sell regions
            if (section.condition.includes('jurisdiction ===')) {
              const regionMatch = section.condition.match(/jurisdiction === ['"]([^'"]+)['"]/);
              if (regionMatch && regionMatch[1]) {
                const region = regionMatch[1];
                // Include section if it's either the primary jurisdiction OR in sell regions
                const conditionMet = (primaryJurisdiction === region) || sellRegions.includes(region);
                
                if (conditionMet) {
                  this.log(`Including section ${section.id} - matches primary jurisdiction or sell regions`);
                } else {
                  this.log(`Skipping section ${section.id} - condition not met for any jurisdiction`);
                  continue;
                }
              } else {
                // Fall back to normal condition evaluation if we can't parse it
                const conditionMet = this.evaluateCondition(section.condition, data);
                if (!conditionMet) {
                  this.log(`Skipping section ${section.id} - condition not met`);
                  continue;
                }
              }
            } else {
              // Regular condition evaluation for non-jurisdiction conditions
              const conditionMet = this.evaluateCondition(section.condition, data);
              if (!conditionMet) {
                this.log(`Skipping section ${section.id} - condition not met`);
                continue;
              }
            }
          }
          
          this.log(`Processing section: ${section.id}`);
          
          // Process the section's content with the data
          let content = section.content;
          if (content) {
            content = this.replaceVariables(content, data);
          } else {
            content = ""; // Handle missing content
          }
          
          // Process any subsections
          if (section.subsections && section.subsections.length > 0) {
            for (const subsection of section.subsections) {
              try {
                // Skip subsections that don't apply based on conditions
                if (subsection.condition) {
                  const subConditionMet = this.evaluateCondition(subsection.condition, data);
                  if (!subConditionMet) {
                    this.log(`Skipping subsection ${subsection.id} - condition not met`);
                    continue;
                  }
                }
                
                this.log(`Processing subsection: ${subsection.id}`);
                
                // Process the subsection's content with the data
                if (subsection.content) {
                  const subContent = this.replaceVariables(subsection.content, data);
                  
                  // Add subsection to content
                  content += `\n\n${subsection.title}\n\n${subContent}`;
                }
              } catch (subError) {
                console.error(`Error processing subsection ${subsection.id}:`, subError);
                // Continue with other subsections even if one fails
              }
            }
          }
          
          policySections.push({
            title: section.title,
            content: content
          });
        } catch (sectionError) {
          console.error(`Error processing section ${section.id}:`, sectionError);
          // Continue with other sections even if one fails
        }
      }
      
      return {
        businessName: data.business_name,
        sections: policySections,
        effectiveDate: data.effective_date
      };
    } catch (error) {
      console.error('Error in generateComprehensivePolicy:', error);
      throw error;
    }
  }
  
  evaluateCondition(condition, data) {
    try {
      this.log(`Evaluating condition: ${condition}`);
      
      // Special handling for common conditions
      if (condition.includes('.includes(')) {
        // Handle array includes conditions safely
        const match = condition.match(/([a-zA-Z_]+)\.includes\('([^']+)'\)/);
        if (match) {
          const [, arrayName, value] = match;
          const array = data[arrayName];
          if (Array.isArray(array)) {
            return array.includes(value);
          }
          return false;
        }
      }
      
      // For simple equality checks
      if (condition.includes('===')) {
        const [left, right] = condition.split('===').map(part => part.trim());
        if (left in data) {
          return data[left] === right.replace(/['"]/g, '');
        }
      }
      
      // If we can't safely evaluate, assume the condition is met
      this.log('Could not safely evaluate condition, defaulting to true');
      return true;
    } catch (error) {
      console.error('Error evaluating condition:', condition, error);
      return true; // Default to including sections on error
    }
  }
  
  replaceVariables(text, data) {
    try {
      // Replace all {variable_name} instances with the corresponding value
      return text.replace(/\{([^}]+)\}/g, (match, key) => {
        if (data[key] !== undefined) {
          return data[key];
        }
        this.log(`Warning: Variable ${key} not found in data`);
        return match; // Keep the original if not found
      });
    } catch (error) {
      console.error('Error replacing variables:', error);
      return text; // Return original on error
    }
  }
  
  formatAsHTML(policy, businessName) {
    try {
      let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy Policy - ${businessName}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            font-size: 24px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        h2 {
            font-size: 20px;
            margin-top: 30px;
        }
        h3 {
            font-size: 18px;
            margin-top: 25px;
        }
        p {
            margin: 15px 0;
        }
        ul {
            margin: 15px 0;
            padding-left: 30px;
            list-style-position: outside; /* Keep bullets outside the text flow */
            width: auto; /* Ensure lists don't expand beyond container */
        }
        li {
            margin-bottom: 8px;
            text-indent: 0; /* Prevent text indentation */
            padding-left: 5px; /* Small padding after bullet */
            width: calc(100% - 10px); /* Ensure list items respect container width */
            box-sizing: border-box;
        }
        /* Special styling for definition lists */
        .definitions-list {
            margin-left: 0;
            padding-left: 20px;
            width: calc(100% - 20px);
        }
        .definitions-list li {
            margin-bottom: 12px;
            padding-right: 10px;
        }
        .effective-date {
            margin-top: 40px;
            font-style: italic;
            color: #666;
        }
        /* Force all content to wrap */
        * {
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
            hyphens: auto;
        }
    </style>
</head>
<body>
    <h1>Privacy Policy - ${businessName}</h1>
    <p class="effective-date">Effective Date: ${policy.effectiveDate}</p>
`;
      
      if (!policy.sections || policy.sections.length === 0) {
        html += `    <p>Error: No policy sections were generated.</p>`;
      } else {
        policy.sections.forEach(section => {
          if (!section.title || !section.content) {
            return; // Skip invalid sections
          }
          
          html += `    <h2>${section.title}</h2>\n`;
          
          // Special handling for the Definitions section to fix bullet point indentation
          if (section.title.includes("Definitions")) {
            // Extract the initial paragraph text (before the bullet points)
            const introText = section.content.split('\n\n')[0];
            
            // Get the bullet points
            const bulletPointsMatch = section.content.match(/\n\n([\s\S]*)/);
            let bulletPoints = bulletPointsMatch ? bulletPointsMatch[1] : '';
            
            // Format the bullet points properly
            if (bulletPoints) {
              bulletPoints = bulletPoints
                .replace(/- \*\*([^:*]+)\*\*:/g, '- <strong>$1</strong>:') // Format definition terms
                .replace(/- \*\*([^:*]+)\*\*/g, '- <strong>$1</strong>') // Format other bold items
                .split('\n-').map(point => point.trim())
                .filter(point => point.length > 0)
                .map(point => `<li>${point.startsWith('-') ? point.substring(1).trim() : point}</li>`)
                .join('\n');
                
              html += `    <p>${introText}</p>\n`;
              html += `    <ul class="definitions-list">\n${bulletPoints}\n    </ul>\n`;
            } else {
              html += `    <p>${section.content}</p>\n`;
            }
          } else {
            // Regular content formatting for other sections
            let sectionContent = section.content;
            
            // Handle markdown-style formatting
            sectionContent = sectionContent.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>'); // Bold text
            
            // Handle headings
            sectionContent = sectionContent.replace(/(### |## )([^\n]+)/g, '</p><h3>$2</h3><p>');
            
            // Handle paragraphs
            sectionContent = sectionContent.replace(/\n\n/g, '</p><p>');
            
            // Handle bullet points properly
            if (sectionContent.includes('\n- ')) {
              // Split by paragraphs first
              const paragraphs = sectionContent.split('</p><p>');
              
              let formattedContent = '';
              
              paragraphs.forEach(para => {
                if (para.includes('\n- ')) {
                  // This paragraph contains bullet points
                  const [beforeList, ...listContent] = para.split('\n- ');
                  
                  // Add the text before the list
                  if (beforeList.trim()) {
                    formattedContent += `<p>${beforeList.trim()}</p>`;
                  }
                  
                  // Format the list items
                  const listItems = listContent.map(item => `<li>${item.trim()}</li>`).join('');
                  formattedContent += `<ul>${listItems}</ul>`;
                } else {
                  // Regular paragraph
                  if (para.trim()) {
                    formattedContent += `<p>${para.trim()}</p>`;
                  }
                }
              });
              
              sectionContent = formattedContent;
            } else {
              // No bullet points, just wrap in paragraph tags if needed
              if (!sectionContent.startsWith('<p>')) {
                sectionContent = `<p>${sectionContent}</p>`;
              }
            }
            
            // Clean up any leftover placeholders or double tags
            sectionContent = sectionContent
              .replace(/<p><\/p>/g, '')
              .replace(/<p><p>/g, '<p>')
              .replace(/<\/p><\/p>/g, '</p>')
              .replace(/<\/h3><p><\/p>/g, '</h3>');
            
            html += `    ${sectionContent}\n`;
          }
        });
      }
      
      html += `</body>
</html>`;
      
      return html;
    } catch (error) {
      console.error('Error formatting HTML:', error);
      return `<html><body><h1>Error Generating Policy</h1><p>There was an error formatting the policy: ${error.message}</p></body></html>`;
    }
  }
  
  formatAsMarkdown(policy, businessName) {
    try {
      let markdown = `# Privacy Policy - ${businessName}\n\n`;
      markdown += `*Effective Date: ${policy.effectiveDate}*\n\n`;
      
      if (!policy.sections || policy.sections.length === 0) {
        markdown += `Error: No policy sections were generated.\n\n`;
      } else {
        policy.sections.forEach(section => {
          if (!section.title || !section.content) {
            return; // Skip invalid sections
          }
          
          markdown += `## ${section.title}\n\n`;
          markdown += `${section.content}\n\n`;
        });
      }
      
      return markdown;
    } catch (error) {
      console.error('Error formatting Markdown:', error);
      return `# Error Generating Policy\n\nThere was an error formatting the policy: ${error.message}`;
    }
  }
  
  formatAsText(policy, businessName) {
    try {
      let text = `PRIVACY POLICY - ${businessName}\n\n`;
      text += `Effective Date: ${policy.effectiveDate}\n\n`;
      
      if (!policy.sections || policy.sections.length === 0) {
        text += `Error: No policy sections were generated.\n\n`;
      } else {
        policy.sections.forEach(section => {
          if (!section.title || !section.content) {
            return; // Skip invalid sections
          }
          
          text += `${section.title.toUpperCase()}\n\n`;
          
          // Remove markdown formatting for plain text
          let content = section.content
            .replace(/\*\*([^*]+)\*\*/g, '$1') // Remove bold formatting
            .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '$1 ($2)') // Convert links to text with URL in parentheses
            .replace(/(### |## )([^\n]+)/g, '$2:'); // Convert headings to text with colon
          
          text += `${content}\n\n`;
        });
      }
      
      return text;
    } catch (error) {
      console.error('Error formatting Text:', error);
      return `ERROR GENERATING POLICY\n\nThere was an error formatting the policy: ${error.message}`;
    }
  }
}

// Export for browser and Node.js environments
if (typeof module !== 'undefined' && module.exports) {
  module.exports = PrivacyPolicyGenerator;
} else {
  window.PrivacyPolicyGenerator = PrivacyPolicyGenerator;
}